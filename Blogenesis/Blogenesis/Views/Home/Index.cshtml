@model List<BlogModel>

@{
    ViewData["Title"] = "Home Page";
}

<!-- Hero Section -->
<div style="background-color: #f8fafc !important; height: 80vh !important; min-height: 600px !important; display: flex !important; align-items: center !important; justify-content: center !important;">
    <div style="max-width: 1200px !important; margin: 0 auto !important; padding: 0 1rem !important; text-align: center !important;">
        <div style="max-width: 900px !important; margin: 0 auto !important;">
            <h1 style="font-size: 3.5rem !important; font-weight: bold !important; margin-bottom: 1.5rem !important; line-height: 1.2 !important; color: #1f2937 !important;">
                Welcome to <span style="color: #2563eb !important;">Blogenesis</span>
            </h1>
            <p style="font-size: 1.25rem !important; margin-bottom: 2rem !important; color: #6b7280 !important; line-height: 1.6 !important;">
                Discover stories, ideas, and expertise from writers on any topic. 
                Join our community of creators and readers.
            </p>
            <div style="display: flex !important; flex-direction: column !important; gap: 1rem !important; align-items: center !important;">
                @if (User.Identity?.IsAuthenticated == true)
                {
                    <a href="@Url.Action("Create", "Blog")" 
                       style="display: inline-flex !important; align-items: center !important; padding: 1rem 2rem !important; font-size: 1.125rem !important; font-weight: 600 !important; border-radius: 0.5rem !important; background-color: #2563eb !important; color: white !important; text-decoration: none !important; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1) !important; transition: all 0.3s !important; border: none !important;">
                        Start Writing
                        <svg style="margin-left: 0.5rem !important; width: 1.25rem !important; height: 1.25rem !important;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                        </svg>
                    </a>
                }
                else
                {
                    <a href="@Url.Action("Register", "Account")" 
                       style="display: inline-flex !important; align-items: center !important; padding: 1rem 2rem !important; font-size: 1.125rem !important; font-weight: 600 !important; border-radius: 0.5rem !important; background-color: #2563eb !important; color: white !important; text-decoration: none !important; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1) !important; transition: all 0.3s !important; border: none !important;">
                        Join Blogenesis
                    </a>
                    <a href="#trending-blogs" 
                       style="display: inline-flex !important; align-items: center !important; padding: 1rem 2rem !important; font-size: 1.125rem !important; font-weight: 600 !important; border-radius: 0.5rem !important; border: 2px solid #2563eb !important; color: #2563eb !important; background-color: transparent !important; text-decoration: none !important; transition: all 0.3s !important;">
                        Explore Blogs
                    </a>
                }
            </div>
        </div>
    </div>
</div>

<!-- Trending Blogs Section -->
<div id="trending-blogs" style="padding: 4rem 0 !important; background-color: #f9fafb !important;">
    <div style="max-width: 1200px !important; margin: 0 auto !important; padding: 0 1rem !important;">
        <div style="display: flex !important; justify-content: space-between !important; align-items: flex-start !important; margin-bottom: 3rem !important; flex-wrap: wrap !important; gap: 1rem !important;">
            <div style="text-align: left !important; flex: 1 !important;">
                <h2 style="font-size: 2.5rem !important; font-weight: bold !important; color: #1f2937 !important; margin-bottom: 1rem !important;">Trending Blogs</h2>
                <p style="font-size: 1.25rem !important; color: #6b7280 !important; max-width: 600px !important; margin: 0 !important;">
                    Discover the latest and most popular stories from our community of writers
                </p>
            </div>
            <div style="flex-shrink: 0 !important; min-width: 200px !important;">
                <select id="topicFilter" style="width: 100% !important; padding: 0.75rem 1rem !important; border: 2px solid #e5e7eb !important; border-radius: 0.5rem !important; background-color: white !important; color: #374151 !important; font-size: 0.875rem !important; font-weight: 500 !important; cursor: pointer !important; transition: all 0.3s !important;">
                    <option value="">Filter by Topic</option>
                    <option value="All">All</option>
                    <option value="Technology">Technology</option>
                    <option value="Lifestyle">Lifestyle</option>
                    <option value="Business">Business</option>
                    <option value="Health">Health</option>
                    <option value="Travel">Travel</option>
                    <option value="Food">Food</option>
                    <option value="Sports">Sports</option>
                    <option value="Entertainment">Entertainment</option>
                    <option value="Education">Education</option>
                    <option value="Science">Science</option>
                </select>
            </div>
        </div>

        @if (Model != null && Model.Any())
        {
            <div style="display: grid !important; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)) !important; gap: 2rem !important; max-width: 1200px !important; margin: 0 auto !important;">
                @foreach(var blog in Model)
                {
                    var subjectTag = blog.Subject;
                    var capitalizedSubject = string.IsNullOrEmpty(subjectTag) ? "" : char.ToUpper(subjectTag[0]) + subjectTag.Substring(1).ToLower();

                    <article style="background-color: white !important; border-radius: 1rem !important; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1) !important; overflow: hidden !important; transition: all 0.3s !important; border: 1px solid #e5e7eb !important;">
                        <div style="padding: 1.5rem !important;">
                            <!-- Author Info -->
                            <div style="display: flex !important; align-items: center !important; gap: 0.75rem !important; margin-bottom: 1rem !important;">
                                <div style="flex-shrink: 0 !important;">
                                    @if (!string.IsNullOrEmpty(blog?.User?.ProfilePicUrl))
                                    {
                                        <img src="@blog.User.ProfilePicUrl" alt="@(blog?.User?.FullName ?? blog?.User?.UserName)" 
                                             style="height: 2.5rem !important; width: 2.5rem !important; border-radius: 50% !important; object-fit: cover !important; border: 2px solid #e5e7eb !important;" />
                                    }
                                    else
                                    {
                                        <div style="height: 2.5rem !important; width: 2.5rem !important; border-radius: 50% !important; background: linear-gradient(to right, #3b82f6, #8b5cf6) !important; display: flex !important; align-items: center !important; justify-content: center !important;">
                                            <span style="color: white !important; font-weight: 600 !important; font-size: 0.875rem !important;">
                                                @((blog?.User?.FullName ?? blog?.User?.UserName ?? "A").Substring(0, 1).ToUpper())
                                            </span>
                                        </div>
                                    }
                                </div>
                                <div>
                                    <p style="font-size: 0.875rem !important; font-weight: 500 !important; color: #1f2937 !important; margin: 0 !important;">@(blog?.User?.FullName ?? blog?.User?.UserName ?? "Anonymous")</p>
                                    <p style="font-size: 0.875rem !important; color: #6b7280 !important; margin: 0 !important;">@blog?.DateCreated.ToString("MMM dd, yyyy")</p>
                                </div>
                            </div>

                            <!-- Blog Content -->
                            <a href="@Url.Action("Details", "Blog", new { id = blog?.Id })" style="display: block !important; text-decoration: none !important;">
                                <h3 style="font-size: 1.25rem !important; font-weight: bold !important; color: #1f2937 !important; margin-bottom: 0.75rem !important; line-height: 1.4 !important; transition: color 0.3s !important;">
                                    @blog?.Title
                                </h3>
                                <p style="color: #6b7280 !important; margin-bottom: 1rem !important; line-height: 1.6 !important; display: -webkit-box !important; -webkit-line-clamp: 3 !important; -webkit-box-orient: vertical !important; overflow: hidden !important;">
                                    @{
                                        // Remove HTML tags for preview and limit to first 150 characters
                                        var cleanContent = System.Text.RegularExpressions.Regex.Replace(blog?.Content ?? "", "<.*?>", " ");
                                        var previewContent = cleanContent.Length > 150 ? cleanContent.Substring(0, 150) + "..." : cleanContent;
                                    }
                                    @previewContent
                                </p>
                            </a>

                            <!-- Blog Meta -->
                            <div style="display: flex !important; align-items: center !important; justify-content: space-between !important; padding-top: 1rem !important; border-top: 1px solid #e5e7eb !important;">
                                <div style="display: flex !important; align-items: center !important; gap: 0.5rem !important; font-size: 0.875rem !important; color: #6b7280 !important;">
                                    <svg style="width: 1rem !important; height: 1rem !important;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span>@blog?.ReadTimeMinutes min read</span>
                                </div>
                                <span style="display: inline-flex !important; align-items: center !important; padding: 0.25rem 0.625rem !important; border-radius: 9999px !important; font-size: 0.75rem !important; font-weight: 500 !important; background-color: #dbeafe !important; color: #1e40af !important;">
                                    @capitalizedSubject
                                </span>
                            </div>
                        </div>
                    </article>
                }
            </div>
        }
        else
        {
            <div style="text-align: center !important; padding: 4rem 0 !important;">
                <div style="max-width: 400px !important; margin: 0 auto !important;">
                    <svg style="margin: 0 auto 1rem auto !important; height: 4rem !important; width: 4rem !important; color: #9ca3af !important;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
                    </svg>
                    <h3 style="font-size: 1.25rem !important; font-weight: 500 !important; color: #1f2937 !important; margin-bottom: 0.5rem !important;">No blogs yet</h3>
                    <p style="color: #6b7280 !important; margin-bottom: 1.5rem !important;">Be the first to create a blog post and start the conversation!</p>
                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        <a href="@Url.Action("Create", "Blog")" 
                           style="display: inline-flex !important; align-items: center !important; padding: 0.75rem 1.5rem !important; border: none !important; font-size: 0.875rem !important; font-weight: 500 !important; border-radius: 0.375rem !important; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important; color: white !important; background-color: #2563eb !important; text-decoration: none !important; transition: background-color 0.3s !important;">
                            Create Your First Blog
                        </a>
                    }
                    else
                    {
                        <a href="@Url.Action("Register", "Account")" 
                           style="display: inline-flex !important; align-items: center !important; padding: 0.75rem 1.5rem !important; border: none !important; font-size: 0.875rem !important; font-weight: 500 !important; border-radius: 0.375rem !important; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important; color: white !important; background-color: #2563eb !important; text-decoration: none !important; transition: background-color 0.3s !important;">
                            Join to Start Writing
                        </a>
                    }
                </div>
            </div>
        }
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const topicFilter = document.getElementById('topicFilter');
    
    topicFilter.addEventListener('change', function() {
        const selectedTopic = this.value;
        
        // Call the FilterBlogs action in Home Controller
        const url = '@Url.Action("FilterBlogs", "Home")';
        
        if (selectedTopic && selectedTopic !== 'All') {
            // Send the selected topic as 'subject' parameter and redirect to trending section
            window.location.href = url + '?subject=' + encodeURIComponent(selectedTopic) + '#trending-blogs';
        } else {
            // If no topic selected or "All" is selected, redirect to Index to show all blogs and go to trending section
            window.location.href = '@Url.Action("Index", "Home")' + '#trending-blogs';
        }
    });
});
</script>
